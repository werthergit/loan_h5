!function(){for(var e=window.location.host,t={callbacks:{},send:function(e,t){this.dispatchMessage("event",e,t)},sendCallback:function(e){var t=n.createEnvelope(e);this.dispatchMessage("callback",t,function(){})},triggerCallback:function(e){var t=this;setTimeout(function(){t.callbacks[e]()},0)},dispatchMessage:function(e,t,n){var i=this;this.callbacks[t.id]=function(){n(),delete i.callbacks[t.id]};var s="jockey://"+e+"/"+t.id+"?"+encodeURIComponent(JSON.stringify(t)),a=document.createElement("iframe");a.setAttribute("src",s),document.documentElement.appendChild(a),a.parentNode.removeChild(a),a=null}},n={listeners:{},dispatcher:null,messageCount:0,on:function(e,t){if(!this.listeners.hasOwnProperty(e)||!this.listeners[e]instanceof Array)this.listeners[e]=[];this.listeners[e].push(t)},off:function(e){if(!this.listeners.hasOwnProperty(e)||!this.listeners[e]instanceof Array)this.listeners[e]=[];this.listeners[e]=[]},send:function(e,t,n){if(t instanceof Function)n=t,t=null;t=t||{},n=n||function(){};var i=this.createEnvelope(this.messageCount,e,t);this.dispatcher.send(i,n),this.messageCount+=1},trigger:function(e,t,n){for(var i=this,s=this.listeners[e]||[],a=0,r=function(){if(a+=1,a>=s.length)i.dispatcher.sendCallback(t)},o=0;o<s.length;o++){var c=s[o];if(c.length<=1)c(n),r();else c(n,r)}},triggerCallback:function(e){this.dispatcher.triggerCallback(e)},createEnvelope:function(t,n,i){return{id:t,type:n,host:e,payload:i}}},i={send:function(e,t){t()},triggerCallback:function(){},sendCallback:function(){}},s=0,a=!1,r=["iPad","iPhone","iPod"];s<r.length;s++)if(navigator.platform.indexOf(r[s])>=0){a=!0;break}var o=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),c=navigator.userAgent.toLowerCase().indexOf("android")>-1;if(a&&o||c)n.dispatcher=t;else n.dispatcher=i;window.Jockey=n}();